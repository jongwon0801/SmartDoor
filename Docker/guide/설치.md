#### 1. 시스템 업데이트
```less
sudo apt-get update
sudo apt-get upgrade -y
```

#### 2. 필요한 패키지를 설치
```less
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common
```

#### 3. Docker의 공식 GPG 키를 추가
```less
curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg | sudo apt-key add -
```


#### 4. Docker 저장소를 추가
```less
echo "deb [arch=armhf] https://download.docker.com/linux/$(. /etc/os-release; echo "$ID") $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list
```

#### 5. 다시 패키지 목록을 업데이트
```less
sudo apt-get update
```

#### 6. Docker를 설치
```less
sudo apt-get install -y docker-ce docker-ce-cli containerd.io
```

#### 7. Docker가 제대로 설치되었는지 확인
```less
sudo docker run hello-world
```

#### 8. (선택사항) sudo 없이 Docker를 사용할 수 있도록 설정
```less
sudo usermod -aG docker $USER
```

#### 9. Docker Compose 설치하기
```less
sudo apt-get update
sudo apt-get install -y python3-pip
sudo pip3 install docker-compose
```

#### 10. 애플리케이션 파일 준비
```less
# 프로젝트 폴더 생성
mkdir ~/tornado_app
cd ~/tornado_app
```

#### 11. requirements.txt 파일을 생성
```less
# 정리해둔 내용 복사
nano requirements.txt
```

#### 12. Dockerfile 생성
```less
cd ~/smartdoor_docker

nano Dockerfile
```

```less
FROM python:3.9-slim

WORKDIR /app

# 시스템 의존성 패키지 설치 (dlib, opencv 등을 위해 필요)
RUN apt-get update && apt-get install -y \
    build-essential cmake \
    libsm6 libxext6 libxrender-dev \
    libgtk-3-dev \
    && rm -rf /var/lib/apt/lists/*

# requirements.txt 복사 및 패키지 설치
COPY requirements.txt .
RUN pip install --no-cache-dir -y -r requirements.txt

# 애플리케이션 파일 복사
COPY . .

# 애플리케이션 실행
CMD ["python", "webserver.py"]
```

#### 13. docker-compose.yml 생성
```less
nano docker-compose.yml
```

```less
version: '3'
services:
  tornado:
    build: .
    container_name: smartdoor_app
    ports:
      - "8080:8080"  
    restart: unless-stopped
    volumes:
      - ./:/app
```

#### 14. nginx root 경로 변경

#### 15. 숨김 파일 뺴고 파일 복사
```less
cp -r /home/pi/www/[^.]* ~/smartdoor_docker/www/
```

#### 16. 유저 단위 서비스 중지
```less
# user 단위 서비스 경로
/home/pi/.config/systemd/user

systemctl --user stop tornado.service
systemctl --user disable tornado.service
```

#### 17. 유저 단위 서비스 파일 생성
```less
mkdir -p ~/.config/systemd/user
nano ~/.config/systemd/user/smartdoor_docker.service
```

```less
[Unit]
Description=Smartdoor Docker Application
After=network-online.target graphical.target

[Service]
WorkingDirectory=/home/pi/smartdoor_docker
ExecStart=/usr/local/bin/docker-compose up --build
ExecStop=/usr/local/bin/docker-compose down

Environment=DISPLAY=:0
Environment="XAUTHORITY=/home/pi/.Xauthority"

Restart=always
RestartSec=10s

[Install]
WantedBy=default.target
```
```less
systemctl --user daemon-reload
systemctl --user enable smartdoor_docker.service
systemctl --user start smartdoor_docker.service
```
















