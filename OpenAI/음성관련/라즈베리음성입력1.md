#### íŒ¨í‚¤ì§€ ì„¤ì¹˜

```less
sudo apt-get update

pip install sounddevice

pip install soundfile

sudo apt-get install libportaudio2
```

#### sounddevice ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ ì¶œë ¥

```less
import sounddevice as sd
print(sd.query_devices())

# device=2ë²ˆ (USB 4K Live Camera)
import sounddevice as sd
device_info = sd.query_devices(2, 'input')
print(device_info)


# ê¸°ë³¸ ì…ë ¥ ë° ì¶œë ¥ ì¥ì¹˜ë¥¼ 'default'(12ë²ˆ)ë¡œ ë³µì›
import sounddevice as sd
sd.default.device = (12, 12)
```


```less
# Python ë‚´ì—ì„œ í™•ì¸ (ì›¹ì„œë²„ë‚˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ)
import os
print("XDG_RUNTIME_DIR =", os.environ.get("XDG_RUNTIME_DIR"))
print("PULSE_SERVER =", os.environ.get("PULSE_SERVER"))

# í„°ë¯¸ë„ì—ì„œ í™•ì¸
echo $XDG_RUNTIME_DIR
echo $PULSE_SERVER


# PulseAudio ì†Œì¼“ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
ls -l /run/user/1000/pulse/native

# PulseAudio ì‹¤í–‰ ì—¬ë¶€ í™•ì¸
ps aux | grep pulseaudio
```

```less
âš ï¸ ë¬¸ì œ ìš”ì 
ì›¹ì„œë²„ë‚˜ Python ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œëŠ” PULSE_SERVER í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìœ¼ë¯€ë¡œ PulseAudioì— ì—°ê²°ì´ ì•ˆ ë©ë‹ˆë‹¤.

ê·¸ë˜ì„œ "íŒŒì¼ì€ ë§Œë“¤ì–´ì§€ëŠ”ë° ìŒì„± ì—†ìŒ" ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤ (ë¬´ìŒ ë…¹ìŒ)
```

âœ… **í˜„ì¬ ìƒíƒœ ìš”ì•½**

| í•­ëª©                                 | ìƒíƒœ                                               |
|--------------------------------------|----------------------------------------------------|
| `pulseaudio`                         | ì •ìƒ ì‹¤í–‰ ì¤‘ (`/usr/bin/pulseaudio ...`)           |
| `/run/user/1000/pulse/native`        | ì¡´ì¬í•¨ (ì†Œì¼“ OK)                                   |
| `$XDG_RUNTIME_DIR`                   | `/run/user/1000` (ì •ìƒ)                            |
| `$PULSE_SERVER`                      | ë¹„ì–´ ìˆìŒ (í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í•„ìš”)                   |
| `Python ë‚´ os.environ['PULSE_SERVER']` | `None` (í™˜ê²½ ë³€ìˆ˜ ë¯¸ì„¤ì •)                          |

```less
import sounddevice as sd

print("ì‚¬ìš© ê°€ëŠ¥í•œ ì˜¤ë””ì˜¤ ì¥ì¹˜ ë¦¬ìŠ¤íŠ¸:")
for i, device in enumerate(sd.query_devices()):
    print(f"{i}: {device['name']} (max input channels: {device['max_input_channels']})")
```

```less
device=2 (USB Audio Device)ëŠ” ì…ë ¥ ì±„ë„ 0 â†’ ë…¹ìŒ ë¶ˆê°€

device=3 (USB 4K Live Camera: Audio)ëŠ” ì…ë ¥ ì±„ë„ 1 â†’ ë…¹ìŒ ê°€ëŠ¥

device=8 (pulse)ì™€ device=12 (default)ëŠ” ì…ë ¥ ì±„ë„ 32 â†’ PulseAudio ê°€ìƒ ì¥ì¹˜, ë…¹ìŒ ê°€ëŠ¥
```

ê²°ë¡  ë° ê¶Œì¥ ì„¤ì •
device=3 ì„ ë…¹ìŒ ì¥ì¹˜ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. (ëª¨ë…¸ 1ì±„ë„)

channels=1 ë¡œ ë…¹ìŒ ì‹œë„


#### test_voice.py
```less
print("ì‹œì‘")  # â† ì´ ì¤„ì´ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸

import sounddevice as sd
import soundfile as sf
import time

print("ğŸ™ï¸ ìŒì„± ë…¹ìŒ ì‹œì‘... 4ì´ˆê°„ ë§í•´ì£¼ì„¸ìš”.")
try:
    duration = 4
    sample_rate = 24000
    device = 2

    recording = sd.rec(
        int(duration * sample_rate),
        samplerate=sample_rate,
        channels=1,
        device=device,
    )
    sd.wait()
    sf.write("user_voice.wav", recording, sample_rate)
    print("âœ… ë…¹ìŒ ì™„ë£Œ: user_voice.wav")
except Exception as e:
    print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")
```

```less
import os
import time
import sounddevice as sd
import soundfile as sf

def voice_record(
    duration=4,
    sample_rate=24000,
    filename="user_voice.wav",
    folder="/home/pi/guest_voice",
) -> str:
    # PulseAudio í™˜ê²½ë³€ìˆ˜ ì„¤ì • (í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì—ë§Œ ì˜í–¥)
    os.environ["XDG_RUNTIME_DIR"] = "/run/user/1000"
    os.environ["PULSE_SERVER"] = "unix:/run/user/1000/pulse/native"

    print("[voice_record] ì‹œì‘")

    if not os.path.exists(folder):
        print(f"[voice_record] í´ë”ê°€ ì—†ì–´ì„œ ìƒì„±: {folder}")
        os.makedirs(folder)

    filepath = os.path.join(folder, filename)

    print(f"ğŸ™ï¸ ìŒì„± ë…¹ìŒ ì‹œì‘... {duration}ì´ˆê°„ ë§í•´ì£¼ì„¸ìš”.")

    try:
        recording = sd.rec(
            int(duration * sample_rate),
            samplerate=sample_rate,
            channels=1,
            device=3,  # USB 4K Live Camera ë§ˆì´í¬ ì…ë ¥ ì¥ì¹˜ ë²ˆí˜¸
        )
        sd.wait()

        sf.write(filepath, recording, sample_rate)
        print(f"âœ… ë…¹ìŒ ì™„ë£Œ, íŒŒì¼ ì €ì¥: {filepath}")

        time.sleep(0.5)
        return filepath

    except Exception as e:
        print(f"[record_user_voice ì˜¤ë¥˜] {e}")
        return ""

if __name__ == "__main__":
    recorded_file = voice_record()
    if recorded_file:
        print(f"ë…¹ìŒ íŒŒì¼ ìœ„ì¹˜: {recorded_file}")
    else:
        print("ë…¹ìŒ ì‹¤íŒ¨")

```

#### í„°ë¯¸ë„ì—ì„œ ë…¹ìŒëœ ìŒì„± ì¶œë ¥

```less
aplay /home/pi/guest_voice/user_voice.wav
```
