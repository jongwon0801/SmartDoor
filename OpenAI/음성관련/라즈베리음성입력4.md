#### 실행해서 현재 재생 중인 프로세스와 연결된 출력 장치 정보 확인 가능
```less
pactl list short sinks
```

| 번호  | 이름                                                                           | 설명                                    |
| --- | ---------------------------------------------------------------------------- | ------------------------------------- |
| `0` | `alsa_output.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.analog-stereo` | 🔊 **USB 오디오 디바이스 (도어락 스피커일 가능성 있음)** |
| `1` | `alsa_output.platform-bcm2835_audio.analog-stereo`                           | 🎧 **Raspberry Pi 내장 3.5mm 헤드폰 출력**   |
| `2` | `alsa_output.platform-fef00700.hdmi.hdmi-stereo`                             | 📺 **HDMI 오디오 출력**                    |


#### 녹음 파일 출력
```less
cvlc /home/pi/guest_voice/voice_record_no.mp3
cvlc -vvv /home/pi/guest_voice/voice_record_no.mp3

출력 중 audio output 관련 로그에서 어느 디바이스를 사용하는지 추정 가능
```

#### cvlc -vvv 키워드로 현재 출력되는 장치 확인
```less
pulse audio output debug: connected to sink alsa_output.platform-fef00700.hdmi.hdmi-stereo
pulse audio output debug: changing sink 2: alsa_output.platform-fef00700.hdmi.hdmi-stereo (내장 오디오  Digital Stereo (HDMI))
```

| 명령어                                               | 출력 방식                 | 출력 장치 지정                     |
| ------------------------------------------------- | --------------------- | ---------------------------- |
| `cvlc --aout alsa --alsa-audio-device hw:1,0 ...` | ALSA 직접 사용, hw:1,0 지정 | ALSA hw:1,0 (USB 사운드카드 등)    |
| `cvlc ...`                                        | 시스템 기본 오디오 출력 사용      | PulseAudio 또는 ALSA 기본 설정에 따름 |



#### pulse audio 출력 장치 변경 & 실행
```less
cvlc --play-and-exit /home/pi/guest_voice/voice_record_no.wav

# 기본 장치 USB_Audio_Device 0 출력으로 설정하기  (도어락 스피커)
# USB 오디오 장치 (0번 카드가 아니라 usb-C-Media_Electronics_Inc.가 붙은 장치)를 기본 출력 장치로 설정하는 겁니다.
pactl set-default-sink alsa_output.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.analog-stereo

# 기본 장치 audio.analog-stereo 1 출력으로 설정하기 (소리안남)
pactl set-default-sink alsa_output.platform-bcm2835_audio.analog-stereo

# 기본 장치 hdmi.hdmi-stereo 2 출력으로 설정하기 (내측스피커)
pactl set-default-sink alsa_output.platform-fef00700.hdmi.hdmi-stereo
```


#### 장치 점유 해제 느려서 --play-and-exit 키워드 넣고 소리 출력해야함
```less
cvlc --play-and-exit /home/pi/guest_voice/voice_record_no.mp3

# Ctrl+C로 끊을 때 VLC가 오디오 장치 점유 해제 못하는 경우 많음
cvlc /home/pi/guest_voice/voice_record_no.mp3

# 현재 기본으로 설정된 sink의 인덱스를 표시
pacmd list-sinks | grep '* index'

* index: 1
```


#### pulse audio 서버 상태를 정확하게 확인
```less
# pulse audio 프로세스 확인
ps aux | grep pulseaudio

# PulseAudio가 정상 작동 중이면 조용히 종료됨
pulseaudio --check

# PulseAudio 서버 연결 확인
pactl info
서버가 작동하지 않으면 오류 메시지(예: Connection failure: Connection refused)

# 실제 서비스 상태, 로그까지 확인
systemctl --user status pulseaudio
```


#### 실제 출력 장치가 어디인지 볼 수 있는 명령
```less
pacmd list-sinks | grep -E 'name:|device.description|index|state'

  * index: 0
	name: <alsa_output.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.analog-stereo>
	state: SUSPENDED
		device.description = "USB Audio Device 아날로그 스테레오 "
    index: 1
	name: <alsa_output.platform-bcm2835_audio.analog-stereo>
	state: SUSPENDED
		device.description = "내장 오디오  Analog Stereo"
    index: 2
	name: <alsa_output.platform-fef00700.hdmi.hdmi-stereo>
	state: SUSPENDED
		device.description = "내장 오디오  Digital Stereo (HDMI)"
```


#### pulse audio 동작 중인 프로세스 종료 (종료 후 pulseaudio --start 키면 에러)
```less
# 현재 로그인한 사용자 세션에서 실행 중인 pulseaudio 프로세스 하나만 종료
pulseaudio -k

# 기다렸다가 프로세스 남아있는지 확인
ps aux | grep pulseaudio

# 시스템에서 실행 중인 모든 pulseaudio 프로세스 전부 종료
killall pulseaudio
```


#### service로 pulseaudio 서버 킨다 (내 컴퓨터(로컬)에서 실행되는 백그라운드 사운드 서버)
```less
systemctl --user start pulseaudio.service

systemctl --user status pulseaudio.service

systemctl --user status pulseaudio.socket

# PulseAudio 서버 실행 (이거말고 서비스로 실행 이거로 안켜짐)
pulseaudio --start

ps aux | grep pulseaudio

ps aux | grep PipeWire

/run/user/1000/pulse/native 있는지확인

/home/pi/.config/pulse 경로
-default-sink	- 기본 출력장치
-default-source	- 기본 입력장치

# PulseAudio는 일반적으로 $XDG_RUNTIME_DIR/pulse/native 소켓으로 통신합니다.
echo $XDG_RUNTIME_DIR
ls -l $XDG_RUNTIME_DIR/pulse/native

echo $PULSE_SERVER
보통은 비어있거나 unix:/run/user/1000/pulse/native 같은 값이 나옵니다.
```

#### 중요! HDMI 화면보호기 상태면 소리 출력 안됨!!
```less
# HDMI 실제 연결 여부
cat /sys/class/drm/card0-HDMI-A-1/status

connected → HDMI 켜짐

disconnected → HDMI 꺼짐 또는 미연결

# HDMI 내측 기본 출력으로 활성화 2번 스피커로 설정
pactl set-default-sink alsa_output.platform-fef00700.hdmi.hdmi-stereo

# usb 외측 기본 출력으로 활성화 0번 스피커로 설정
pactl set-default-sink alsa_output.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.analog-stereo

# --aout=pulse 옵션은 VLC가 PulseAudio로 강제 출력
cvlc --aout=pulse --play-and-exit /home/pi/guest_voice/voice_record_no.wav
```

#### 소리 출력 디바이스 음량 조절
```less
#  ALSA 쪽에서 HDMI 오디오 볼륨이 너무 낮거나 뮤트 되어있는지 확인
alsamixer
alsamixer 실행 후 F6 눌러 HDMI 디바이스 선택하고 볼륨 확인/조정
```

#### 출력 장치 조회
```less
pacmd list-sinks | grep -E 'name:|device.description|index|state'

pacmd list-sinks | grep '* index'

pactl list short sinks

pactl list sinks

pactl info
```

#### 입력 장치 조회
```less
pacmd list-sources | grep -E 'name:|device.description|index|state'

pacmd list-sources | grep '* index'

pactl list short sources

pactl list sources
```

#### 오디오 출력 장치를 지정했느냐 안 했느냐 차이
```less
# hdmi 내측 스피커 벨 출력 (오디오 출력장치 지정)
cvlc --play-and-exit /home/pi/www/sound/bell.wav --alsa-audio-device hdmi:CARD=vc4hdmi0,DEV=0

# 별도의 오디오 장치 지정 없이 기본 ALSA/PulseAudio 설정을 따른다
cvlc --play-and-exit /home/pi/guest_voice/voice_record_no.wav

# 도어락 외측 스피커 벨 출력
cvlc --play-and-exit /home/pi/www/sound/bell.wav --alsa-audio-device iec958:CARD=Device,DEV=0 --aout=alsa
```

#### vlc cvlc 안전종료
```less
1. q 키 누르기

cvlc 실행 중에 터미널에서 q 키를 누르면 VLC가 정상 종료하면서 오디오 장치도 제대로 해제합니다.

Ctrl+C보다 훨씬 안전해요.
```

```less
2. kill 명령어 사용 (다른 터미널에서)

ps aux | grep vlc 로 PID 확인 후

kill PID (SIGTERM) 하면 정상 종료 시도

kill -9 PID 는 강제 종료이니 가능한 kill만 쓰는 게 좋아요.
```

```less
3. 재생할 때 --play-and-exit 옵션 사용

cvlc --play-and-exit /home/pi/guest_voice/voice_record_no.wav

재생 끝나면 자동으로 종료되므로, 수동 종료를 줄여줍니다.
```

✅ HDMI 출력 상태 점검
```less
amixer -c 3

alsamixer -c 3
```
```less
alsamixer -c 1
1번 카드 소리조절
```




