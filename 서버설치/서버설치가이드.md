#### 1-1. Ubuntu 24.04.2 LTS OS ì„¤ì¹˜
```less
1. ubuntu server lts 24.04.2 iso ë‹¤ìš´

2. ì—ì²˜ë¡œ usb í”Œë˜ì‹œ ë“œë¼ì´ë¸Œì— iso êµ½ê¸°

3. ë³¸ì²´ ê½‚ê³  ë¶€íŒ… -> ì„¤ì¹˜ (ê¸°ì¡´ì— os ê¹”ë ¤ìˆìœ¼ë©´ 4ë²ˆ)

4. ë¶€íŒ… ì‹œ f2 esc del f12 f9 ë“± ëˆŒëŸ¬ì„œ bios ì„¤ì • ë³€ê²½
í•˜ë“œë””ìŠ¤í¬ os ë¥¼ í›„ìˆœìœ„ë¡œ ë†“ê³  usb í”Œë˜ì‹œ ë“œë¼ì´ë¸Œë¥¼ ë¶€íŒ… 1ìˆœìœ„ ë³€ê²½
```

#### 1-2. ì„¤ì¹˜ íŠ¹ì´ì‚¬í•­
```less
1. LAN ì¼€ì´ë¸” ê½‚í˜€ìˆëŠ” ìƒíƒœë¡œ ë„¤íŠ¸ì›Œí¬ ì¡ê³  ì„¤ì¹˜ í•˜ëŠ”ê²Œ ì¢‹ìŒ

2. ì„¤ì¹˜ ë„ì¤‘ open-ssh ê°™ì´ ì„¤ì¹˜

3. íŒŒí‹°ì…˜ ì„¤ê³„ ê±´ë„ˆë›°ê³  ì „ì²´ ì €ì¥ê³µê°„ ì“°ëŠ”ê±¸ë¡œ ì„¤ì¹˜
```

#### 1-3. ì„¤ì¹˜ í›„ ë²„ì ¼ í™•ì¸
```less
lsb_release -a

Distributor ID:	Ubuntu
Description:	Ubuntu 24.04.2 LTS
Release:	24.04
Codename:	noble
```

#### 1-4. Ubuntu ê³„ì •
```less
name : wikibox  (ì‚¬ìš©ì ì´ë¦„ ì˜ë¯¸ì—†ìŒ)

Server name : wikibox  (ì„œë²„ ì´ë¦„)

user : hizib
pw : wikibox
```

#### 2-1. ë„¤íŠ¸ì›Œí¬ tool ì„¤ì¹˜

| íŒ¨í‚¤ì§€ëª…              | ì„¤ëª…                                     | ì„¤ì¹˜ ëª…ë ¹ì–´                             |
| ----------------- | -------------------------------------- | ---------------------------------- |
| `isc-dhcp-client` | `dhclient` ëª…ë ¹ì–´ ì‚¬ìš© ê°€ëŠ¥ (DHCP IP ìˆ˜ë™ ìš”ì²­ ë“±) | `sudo apt install isc-dhcp-client` |
| `net-tools`       | `ifconfig`, `netstat` ë“± ì „í†µì  ëª…ë ¹ì–´ ì‚¬ìš© ê°€ëŠ¥  | `sudo apt install net-tools`       |
| `resolvconf`      | DNS ì„¤ì • ìë™ ë™ê¸°í™” (DNS ë¬¸ì œ ë°©ì§€ìš©)             | `sudo apt install resolvconf`      |


#### 2-2. sudoer ê¶Œí•œì„ ì‚¬ìš©ìì—ê²Œ ë¶€ì—¬
```less
sudo visudo

# í•˜ë‹¨ì— ì¶”ê°€
hizib ALL=(ALL) NOPASSWD:ALL

ì‚¬ìš©ì hizibëŠ” ëª¨ë“  ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ sudoë¡œ ì‹¤í–‰ ê°€ëŠ¥.
ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì‹¤í–‰ ê°€ëŠ¥í•¨
```


#### 3-1. nginx ì„¤ì¹˜
```less
sudo apt-get update
sudo apt install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 3-2. nginx conf.d ì„¤ì •

```less
sudo nano /etc/nginx/conf.d/hizib.conf

server {
listen 80;
    server_name api2.hizib.wikibox.kr;

    charset utf-8;
    #access_log  /var/log/nginx/hizib.access.log  main;
    error_log /var/log/nginx/hizib.error.log;

    location /image {
        alias /home/hizib/image;
    }

    location / {
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, PATCH, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization';
            add_header 'Access-Control-Max-Age' 86400;
            return 204;
        }

        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Content-Type' 'application/json' always;
        root /home/hizib;
        index index.html index.htm index.php;
        if (!-e $request_filename) {
                rewrite ^(.*)$ /index.html;
        }
    }

    #error_page 404 /404.html;


    # redirect server error pages to the static page /50x.html
    #
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }

    location ~ \.(php|html|htm)$ {
        root           /home/hizib;
        fastcgi_pass   unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index  index.html;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
        #include snippets/fastcgi-php.conf;
    }
}

```

#### 3-3. sudo nano /etc/nginx/nginx.conf

```less
#include /etc/nginx/sites-enabled/*; ì£¼ì„ì²˜ë¦¬
```

#### 4-1. php 7.4 ì„¤ì¹˜
```less
sudo apt-get install -y software-properties-common

sudo add-apt-repository ppa:ondrej/php

sudo apt-get update

sudo apt-get install -y php7.4

sudo apt-get install -y php7.4-{curl,gd,mbstring,mysql,soap,json,intl,zip,xml,xmlrpc,cli,xsl}
```


#### 4-2. ì•„íŒŒì¹˜ ì œê±° (php ì„¤ì¹˜ì‹œ ìë™ ì„¤ì¹˜ë¨)

#### Apache ê´€ë ¨ íŒ¨í‚¤ì§€ í™•ì¸
```less
dpkg -l | grep apache2
```

#### Apache ì™„ì „íˆ ì œê±°
```less
sudo apt purge apache2 apache2-utils apache2-bin apache2.2-common

sudo apt autoremove
```


#### 4-3. php.ini ì„¤ì • ë³€ê²½
```less
sudo nano /etc/php/7.4/fpm/php.ini

//short_open_tagë¥¼ ê²€ìƒ‰í•´ì„œ onìœ¼ë¡œ ì„¤ì • ë³€ê²½
; short_open_tag=Off
short_open_tag=On

//memory_limitë¥¼ ê²€ìƒ‰í•´ì„œ 256Më¡œ ë³€ê²½
memory_limit = 256M


//upload_max_filesizeë¥¼ ê²€ìƒ‰í•´ì„œ 1024Më¡œ ë³€ê²½
upload_max_filesize = 1024M

//max_file_uploadsë¥¼ ê²€ìƒ‰í•´ì„œ 20ìœ¼ë¡œ ë³€ê²½
max_file_uploads = 20

//date.timezoneë¥¼ ê²€ìƒ‰í•´ì„œ Asia/Seoulë¡œ ì„¤ì •
date.timezone = Asia/Seoul
```

#### 4-4. /etc/php/7.4/fpm/pool.d/www.conf ì„¤ì •ë³€ê²½
```less
sudo nano /etc/php/7.4/fpm/pool.d/www.conf

listen = /var/run/php/php7.4-fpm.sock

# ë§¨ì•ì— ; ì—†ì• ì•¼í•¨
security.limit_extensions = .php .html .htm
```

#### 4-5. php ì¬ê°€ë™
```less
sudo systemctl restart php7.4-fpm.service
```

#### 5-1. mariadb ì„¤ì¹˜

```less
sudo apt install mariadb-server
sudo systemctl start mariadb
sudo systemctl enable mariadb

# enter ëˆ„ë¥´ë‹¤ê°€ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
sudo mariadb-secure-installation

sudo mysql -u root -p
ë¹„ë°€ë²ˆí˜¸ : wikibox
```

#### 5-2. mariadb ë²„ì ¼ í™•ì¸

```less
# mysql ë²„ì ¼ í™•ì¸
mysql -u root -p -e "SELECT VERSION();"

MariaDBëŠ” ìš°ë¶„íˆ¬ ë²„ì „ì— ë”°ë¼ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì¹˜ë˜ëŠ” ë²„ì „ì´ ë‹¤ë¦…ë‹ˆë‹¤.
ìš°ë¶„íˆ¬ì˜ APT íŒ¨í‚¤ì§€ ì €ì¥ì†Œì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ MariaDB ë²„ì „ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

+-----------------------------------+
| VERSION()                         |
+-----------------------------------+
| 10.11.13-MariaDB-0ubuntu0.24.04.1 |
+-----------------------------------+
```

#### 5-3. DB user(hizib) ìƒì„±
```less
# ë£¨íŠ¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í–ˆëŠ”ì§€ í™•ì¸
SELECT USER(), CURRENT_USER();

# ì‚¬ìš©ì ìƒì„±
CREATE USER 'hizib'@'%' IDENTIFIED BY 'wikibox';

# ê¶Œí•œ ë¶€ì—¬ (ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ë¶€ì—¬ GRANT OPTIONì€ ìƒëµ)
GRANT ALL PRIVILEGES ON *.* TO 'hizib'@'%';

# ë°˜ì˜
FLUSH PRIVILEGES;

# ëª¨ë“  ì‚¬ìš©ì ë³´ê¸°
SELECT user, host FROM mysql.user;
```

#### root ìœ ì €ë¡œ DB ë¡œê·¸ì¸
```less
sudo mysql -u root -p

id : root
pw : wikibox
```

#### hizib ìœ ì €ë¡œ DB ë¡œê·¸ì¸
```less
mysql -u hizib -p

id : hizib
pw : wikibox

SELECT User, Host FROM mysql.user;
+-------------+-----------+
| User        | Host      |
+-------------+-----------+
| hizib        | %        |
| mariadb.sys | localhost |
| mysql       | localhost |
| root        | localhost |
+-------------+-----------+
```

#### 5-4. ì›Œí¬ë°´ì¹˜ ì ‘ì† í—ˆìš©
```less
# mariaDB ì™¸ë¶€ ì ‘ì† í—ˆìš©
sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf

# 127.0.0.1 ì´ë©´ ì™¸ë¶€ì—ì„œ ì ‘ì† ë¶ˆê°€ëŠ¥
bind-address = 0.0.0.0

sudo systemctl restart mariadb
```

#### 5-5. ì›Œí¬ë°´ì¹˜ì—ì„œ .sql ì¿¼ë¦¬ ë³µë¶™(ìš©ëŸ‰ ì‘ì„ê²½ìš°) or ì„œë²„ cli ì—ì„œ ëª…ë ¹ì–´  
```less
# macì— ìˆëŠ” ì„œë²„ì—ì„œ ë³µì‚¬í•œ .sql íŒŒì¼ì„ 192.168.0.73 ìœ¼ë¡œ ë³µì‚¬
scp /Users/jongwon/Smartdoor/server_Test/hizibbackup.sql hizib@192.168.0.73:/home/hizib/

show databases;
drop database hizib;
create databases hizib;

# /home/hizib ê²½ë¡œì—ì„œ ì‹¤í–‰
mysql -u hizib -p hizib < hizibbackup.sql
```
#### 6-1. certbot ì„¤ì¹˜

```less
# ìµœì‹  ë²„ì „ ëŒ€ì•ˆ (Ubuntu 24.04 ì´ìƒ)
sudo apt update
sudo apt install certbot python3-certbot-nginx

# certbot
Nginx ì›¹ ì„œë²„ì—ì„œ ìë™ìœ¼ë¡œ SSL ì¸ì¦ì„œë¥¼ ì„¤ì¹˜Â·ê°±ì‹ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Certbotì˜ Nginx í”ŒëŸ¬ê·¸ì¸

# ê³µì¸ ë„ë©”ì¸ì„ ì‚¬ìš©í•´ì•¼ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
sudo certbot --nginx -d api2.hizib.wikibox.kr
```

#### 6-2. ğŸ” ë°œê¸‰ ê²°ê³¼ ìš”ì•½
```less
ë„ë©”ì¸: api2.hizib.wikibox.kr

ì¸ì¦ì„œ ìœ„ì¹˜:

ì „ì²´ ì²´ì¸: /etc/letsencrypt/live/api2.hizib.wikibox.kr/fullchain.pem

ê°œì¸ í‚¤: /etc/letsencrypt/live/api2.hizib.wikibox.kr/privkey.pem

ìë™ ê°±ì‹ : ì„¤ì •ë¨ (cron ë˜ëŠ” systemd timerì— ì˜í•´ ê´€ë¦¬ë¨)

Nginx ì„¤ì • íŒŒì¼ ìˆ˜ì •ë¨: /etc/nginx/conf.d/hizib.confì— HTTPS ì ìš©ë¨
```

#### 7-1. Mosquitto ì„¤ì¹˜
```less
sudo apt install mosquitto mosquitto-clients

sudo systemctl enable mosquitto.service

sudo systemctl restart mosquitto.service
```

#### 7-2. mqtt ì„¤ì • ë³€ê²½
```less
id : hizib
pw : dnlzlqkrtm

# ì‚¬ìš©ì(hizib) ì™€ ë¹„ë°€ë²ˆí˜¸(wikibox) ìƒì„±
sudo mosquitto_passwd -c /etc/mosquitto/pwfile hizib

Password: dnlzlqkrtm
Reenter password: dnlzlqkrtm
```

#### mosquitto ì‚¬ìš©ì ë³€ê²½
```less
# ì „ì²´ ì‚¬ìš©ì ì‚­ì œ
sudo rm /etc/mosquitto/pwfile

# pwfile ì•ˆì— ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì´ ìˆì„ ìˆ˜ ìˆê³ , ê·¸ì¤‘ hizibë§Œ ì œê±°í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
sudo mosquitto_passwd -D /etc/mosquitto/pwfile hizib

# pwfileì„ ì²˜ìŒë¶€í„° ìƒˆë¡œ ìƒì„±í•˜ê³ , hizibë§Œ ë“±ë¡, ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ë¥¼ ëª¨ë‘ ì§€ìš°ê³ , ìƒˆë¡œ ì‹œì‘
sudo mosquitto_passwd -c /etc/mosquitto/pwfile hizib

dnlzlqkrtm
```

#### ê¶Œí•œ, ì‚¬ìš©ì ë³€ê²½
```less
# ê¶Œí•œ ìˆ˜ì •
sudo chmod 640 /etc/mosquitto/pwfile

# ì½ê¸° ê¶Œí•œì€ mosquitto ì‚¬ìš©ìë§Œ ê°–ë„ë¡ ì œí•œ (ë³´ì•ˆ ê°•í™”)
sudo chown mosquitto:mosquitto /etc/mosquitto/pwfile
```

#### 7-3. Mosquitto ì„¤ì •íŒŒì¼ ìˆ˜ì •
```less
# Mosquitto ì„¤ì •íŒŒì¼ ìˆ˜ì •
sudo nano /etc/mosquitto/mosquitto.conf

# ë‚´ìš©ì— ì•„ë˜ ì„¸ ì¤„ ì¶”ê°€

listener 1883
password_file /etc/mosquitto/pwfile
allow_anonymous false

listener 1883
password_file: ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•œ íŒŒì¼ ê²½ë¡œ ì§€ì •
allow_anonymous false: ìµëª… ì ‘ì† ì°¨ë‹¨ â€” ì‚¬ìš©ì/ë¹„ë°€ë²ˆí˜¸ í•„ìˆ˜

# mosquitto ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart mosquitto
```

#### 7-4. python paho-mqttì„¤ì¹˜
```less
sudo apt install python3-paho-mqtt
```

#### 7-5. mqtt test
```less
# allow_anonymous = true / publish
mosquitto_pub -h 175.211.153.28 -t test/topic -m "Hello MQTT!"

# allow_anonymous = false / publish
mosquitto_pub -h 175.211.153.28 -p 1883 -t test/topic -m "Hello MQTT!" -u hizib -P dnlzlqkrtm

# allow_anonymous = true / subscribe
mosquitto_sub -h 175.211.153.28 -t test/topic

# allow_anonymous = false / subscribe
mosquitto_sub -h 175.211.153.28 -t test/topic -u hizib -P dnlzlqkrtm
```

```less
allow_anonymous trueì´ë©´:
ì¸ì¦ ì—†ì´ ëˆ„êµ¬ë‚˜ publish/subscribe ê°€ëŠ¥ â†’ ì˜ ë™ì‘í•¨

allow_anonymous falseë¡œ ë°”ê¾¸ë©´:
í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ì¦ ì—†ì´ ì ‘ì† ë¶ˆê°€ â†’ ê·¸ë˜ì„œ ìˆ˜ì‹ ì´ ì•ˆ ë¨
```

#### 8-1. ë¹„ì¦ˆë¿Œë¦¬ì˜¤ ì„¤ì¹˜

```less
https://www.bizppurio.com/help/download?qnaSelect=M
ë¹„ì¦ˆí´ë¼ì´ì–¸íŠ¸ DBì—°ë™ í†µí•©ë°œì†¡ëª¨ë“ˆ v4.07(UTF8 ì§€ì›) 2025-04-25  /  biz_client_v4007.zip

# Mac -> ì„œë²„ë¡œ ì••ì¶•íŒŒì¼ ë³µì‚¬
scp /Users/jongwon/Smartdoor/server_Test/biz_client_v4007.zip hizib@192.168.0.73:/home/hizib/bizppurio/

mkdir bizppurio

sudo apt install unzip

sudo unzip biz_client_v4007.zip
```

#### 8-2. config/uds.conf ê³„ì • ì„¤ì •
```less
/home/hizib/bizppurio/config/uds.conf

UDS_IP = biz.ppurio.com
UDS_SEND_PORT = 18300
UDS_RECV_PORT = 18400
UDS_ID = hizibtest
UDS_PW = wiki0800*
USE_SSL = Y

DBNAME = MYSQL

DBURL = jdbc:mysql://localhost:3306/hizib?useUnicode=true&characterEncoding=utf-8&useSSL=false&allowPublicKeyRetrieval=true
DBUSER = hizib
DBPASS = wikibox
```

#### DBURL ì˜µì…˜
| ì˜µì…˜                             | ì„¤ëª…                                          | í•„ìš” ì—¬ë¶€                             |
| ------------------------------ | ------------------------------------------- | --------------------------------- |
| `useUnicode=true`              | ìœ ë‹ˆì½”ë“œ ë¬¸ì ì§€ì› (í•œê¸€ ë“±)                           | âœ… ê±°ì˜ í•­ìƒ í•„ìš”                        |
| `characterEncoding=utf-8`      | ë¬¸ì ì¸ì½”ë”©ì„ UTF-8ë¡œ ì§€ì •                           | âœ… í•œê¸€ ê¹¨ì§ ë°©ì§€                        |
| `useSSL=false`                 | SSL ì—†ì´ ì ‘ì† (ë¡œì»¬/ë‚´ë¶€ë§ì—ì„œ ì¼ë°˜ì )                    | âœ… SSL ë¯¸ì‚¬ìš© ì‹œ í•„ìš” (ê²½ê³  ë°©ì§€)            |
| `allowPublicKeyRetrieval=true` | ì„œë²„ì—ì„œ ê³µê°œí‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í—ˆìš© (MySQL 8 ì´ìƒì¼ ë•Œ ì£¼ë¡œ í•„ìš”) | ğŸ”¶ **MySQL 8 ì´ìƒì´ë©´ í•„ìš”**, ì•„ë‹ˆë©´ ìƒëµ ê°€ëŠ¥ |


#### 8-3. ì‹¤í–‰ê¶Œí•œ ë¶€ì—¬

```less
/home/hizib/bizppurio/script
ls -al

sudo chmod 755 *
ls -al
```

#### 8-4. ìë°” ì„¤ì¹˜
```less
sudo apt update
sudo apt install openjdk-21-jre-headless

java -version
```

#### ë¹„ì¦ˆ í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ ì¤‘ í™•ì¸
```less
# biz_client.jar ì‹¤í–‰ ì¤‘ í™•ì¸
ps aux | grep biz_client.jar | grep -v grep
```

#### 8-5. íŒŒì¼ ì†Œìœ ê¶Œ ë³€ê²½
```less
sudo chown -R hizib:hizib /home/hizib/bizppurio

# ë‚´ë¶€ì ìœ¼ë¡œ íŒŒì¼ ì ‘ê·¼ ë˜ëŠ” ê²½ë¡œ ì²˜ë¦¬ì— root ì†Œìœ ê¶Œì´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ë³€ê²½ ì´ì „
-rw-r--r-- 1 root root 12650 Jun  2 01:15 uds.confx

# ë³€ê²½ ì´í›„
-rw-rw-r--  1 hizib hizib 12309 Jun 17 02:39 uds.confx
```

#### ì•„ì›ƒ ë°”ìš´ë“œ í¬íŠ¸ ì—´ê¸°
```less
/home/hizib/bizppurio/config/uds.confx í™•ì¸

UDS_IP = biz.ppurio.com
UDS_SEND_PORT = 18300
UDS_RECV_PORT = 18400

# ip í™•ì¸
nslookup biz.ppurio.com
-> 27.102.215.25

sudo ufw allow out to 27.102.215.25 port 18300 proto tcp

sudo ufw allow out to 27.102.215.25 port 18400 proto tcp

# ì—°ê²° ì¤‘ì¸ ì†Œì¼“ ë³´ê¸°
ss -tnp | grep 18300
ss -tnp | grep 18400

# í˜„ì¬ TCP ì—°ê²° ìƒíƒœë¥¼ í™•ì¸
netstat -tnp | grep 18300
netstat -tnp | grep 18400
```

#### 8-6. ì „ì†¡ ì‹œê°„ ë¬¸ì œ í•´ê²° ë°©ë²•

sudo nano /home/hizib/bizppurio/script/biz_start

#### ì›ë˜ ì„¸íŒ…
```less
#!/bin/sh

proc=`ps -ef | grep biz_client | grep -v vi |grep -v grep | grep -v sh`
if [ X"$proc" != X"" ]; then
        echo "Already Invoked"
        exit
fi

cd ..
java -Duser.timezone=GMT+09:00 -jar biz_client.jar config/uds &
```

#### ë¡œê·¸ ë‚¨ê¸°ëŠ” ì„¸íŒ…
```less
#!/bin/sh

# ì ˆëŒ€ ê²½ë¡œ ì„¤ì • (biz_start ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ì— ë”°ë¼ ìˆ˜ì • í•„ìš”)
BASE_DIR="/home/hizib/bizppurio"

# ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
if pgrep -f biz_client.jar > /dev/null; then
    echo "Already Invoked"
    exit 0
fi

# ì‹¤í–‰ ë¡œê·¸ ë‚¨ê¸°ê¸°
echo "Starting biz_client at $(date)" >> "$BASE_DIR/biz_start.log"

# ìƒìœ„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd "$BASE_DIR" || exit 1

# ìë°” í”„ë¡œê·¸ë¨ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
java -Duser.timezone=GMT+09:00 -jar biz_client.jar config/uds >> "$BASE_DIR/biz_start.log" 2>&1 &

exit 0
```

#### 8-7. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```less
cd /home/hizib/bizppurio/script/

./biz_start (#!/bin/sh ìˆì–´ì•¼ ê°€ëŠ¥) 

ì¬ë¶€íŒ…í•˜ë©´ ì…¸ì„ ë‹¤ì‹œ ì‹¤í–‰í•´ì¤˜ì•¼í•¨
crontab or service ë“±ë¡

sudo crontab -e

@reboot /home/hizib/bizppurio/script/biz_start

# ì‹œìŠ¤í…œ íƒ€ì„ì¡´ì„ í•œêµ­ ì‹œê°„(KST, UTC+9)ìœ¼ë¡œ ì„¤ì •í•˜ê¸°
sudo timedatectl set-timezone Asia/Seoul

timedatectl status

# biz_client.jar ì‹¤í–‰ ì¤‘ í™•ì¸
ps aux | grep biz_client.jar | grep -v grep
```

#### 8-8. SmartdoorGuestkey.php ì£¼ì†Œë³€ê²½
```less
# https://api.hizib.wikibox.kr ì£¼ì†Œ ìˆ˜ì •
-> https://api2.hizib.wikibox.kr

sudo nano SmartdoorGuestkey.php

sudo systemctl restart php7.4-fpm
```

#### 9-1. í˜„ì¬ ë””ë ‰í† ë¦¬ ìˆ¨ê¹€íŒŒì¼ ë¹¼ê³  ì••ì¶•
```less
cd /home/hizib

sudo tar czvf hizib_backup.tar.gz --exclude='.*' *
```

#### 9-2. Macì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰
```less
#  Macì—ì„œ ëª…ë ¹ì–´ ì³ì„œ í´ë¼ìš°ë“œ íŒŒì¼ ë°›ê¸°
scp ubuntu@13.124.155.19:/home/hizib/hizib_backup.tar.gz /Users/jongwon/Smartdoor/server_Test

# ë§¥ì—ì„œ í…ŒìŠ¤íŠ¸ ì„œë²„ë¡œ ë³µì‚¬
scp /Users/jongwon/Smartdoor/server_Test/hizib_backup.tar.gz hizib@192.168.0.73:/home/hizib/

tar xzvf hizib_backup.tar.gz
```

#### 9-3. /home/hizib ê¶Œí•œ ë¶€ì—¬
```less
sudo chmod 755 /home/hizib
```

#### 10-1. Mqtt ë¸Œë¡œì»¤ ì£¼ì†Œ ìˆ˜ì •
```less
sudo nano mqtt.py 

# broker ì •ë³´
broker_address = "175.211.153.28"

sudo nano mqtt_reply.py

# broker ì •ë³´
broker_address = "175.211.153.28"
```

#### 10-2. /home/hizib/lib.php ìˆ˜ì •
```less
<?php
//dbì„¤ì •
$_lib['db']['master'] = new stdClass();
$_lib['db']['master'] -> type = "mysql";
$_lib['db']['master'] -> host = "localhost";
$_lib['db']['master'] -> port = 3306;
$_lib['db']['master'] -> name = "hizib";
$_lib['db']['master'] -> user = "hizib";
$_lib['db']['master'] -> passwd = "wikibox";
$_lib['db']['master'] -> charset = "utf8";
$_lib['db']['master'] -> autocommit = 1;

$_lib['db']['slave'] = new stdClass();
$_lib['db']['slave'] -> type = "mysql";
$_lib['db']['slave'] -> host = "localhost";
$_lib['db']['slave'] -> port = 3306;
$_lib['db']['slave'] -> name = "hizib";
$_lib['db']['slave'] -> user = "hizib";
$_lib['db']['slave'] -> passwd = "wikibox";
$_lib['db']['slave'] -> charset = "utf8";
$_lib['db']['slave'] -> autocommit = 1;

//mqtt
$_lib['mqtt']['host'] = "175.211.153.28";
$_lib['mqtt']['port'] = "1883";
$_lib['mqtt']['user'] = "hizib";
$_lib['mqtt']['passwd'] = "wikibox
";
//$_lib['mqtt']['host'] = "118.67.142.61";

//íŠ¹ë³„ path ì„¤ì •
$_lib['directory']['www'] = '/home/hizib';				//ì¼ë°˜ ì‚¬ì´íŠ¸
$_lib['directory']['m'] = '/home/hizib';				//m ì‚¬ì´íŠ¸
$_lib['directory']['master'] = '/home/hizib';			//ê´€ë¦¬ì ì‚¬ì´íŠ¸
$_lib['directory']['api'] = '/home/hizib';				//api ì‚¬ì´íŠ¸
$_lib['directory']['app'] = '/home/hizib';				//APP ì‚¬ì´íŠ¸

//íŠ¹ë³„ url ì„¤ì •
$_lib['url']['www'] = '//www.hizib.wikibox.kr';			//ì¼ë°˜ ì‚¬ì´íŠ¸
$_lib['url']['m'] = '//m.hizib.wikibox.kr';				//m ì‚¬ì´íŠ¸
$_lib['url']['master'] = '//master.hizib.wikibox.kr';	//ê´€ë¦¬ì ì‚¬ì´íŠ¸
$_lib['url']['api'] = '//api.hizib.wikibox.kr';			//api ì‚¬ì´íŠ¸
$_lib['url']['app'] = 'https://api.hizib.wikibox.kr/download';	//APP ì‚¬ì´íŠ¸

//ê¸°ë³¸ì ì¸ ì •ì˜
$_lib['website'] = new stdClass();
$_lib['website'] -> name = "WIKI Smartdoor";
$_lib['website'] -> nickname = "ìœ„í‚¤ ìŠ¤ë§ˆíŠ¸ë„ì–´";
$_lib['website'] -> callback = "15774594";
$_lib['website'] -> email = "webmaster@wikibox.kr";
$_lib['website'] -> domain = "hizib.wikibox.kr";

$_lib['directory']['root'] = '/home/hizib/';
$_lib['directory']['php'] = '/home/hizib/php';
$_lib['directory']['python'] = '/home/hizib/python';
$_lib['directory']['library'] = $_lib['directory']['php'].'/library';
$_lib['directory']['default'] = $_lib['directory']['root'].'/www';

$_lib['directory']['home'] = $_lib['directory']['www'];

//ê¸°ë³¸ì–¸ì–´ ì„¤ì •
$_lib['language'] = 'ko,en';

//ì•„ê³ ë¼ì„¤ì •
$_lib['agora']['appID'] = "8a8331548d8c4b88a76952d9b103cbad";
$_lib['agora']['appCertificate'] = "33e81f0573a64f9b895a9d2341e4361b";

//Azure ì•ˆë©´ì¸ì‹ ì„¤ì •
$_lib['azure']['appkey'] = "33e81f0573a64f9b895a9d2341e4361b";

//faceplusplus
$_lib['faceplusplus']['apikey'] = "dQsdsb--qjBV-eGNnSwC3-qVc5XLn40o";
$_lib['faceplusplus']['apiscret'] = "TcH4v9nQPjNMOCx5w1yJmYUBHeiitZss";

//naver
$_lib['ncloud']['accessKey'] = 'TTaMlvfgSD23fz3hh6wd';
$_lib['ncloud']['secretKey'] = 'bpPqe72iGkBajHL4h3noqGNqiRakch9eh9HvmC1Q';
$_lib['ncloud']['serviceId'] = [];
$_lib['ncloud']['serviceId']['push'] = 'ncp:push:kr:263983027579:wikibox';
$_lib['ncloud']['serviceId']['sms'] = 'ncp:sms:kr:263983040365:watchbook';
$_lib['ncloud']['serviceId']['bizmsg'] = 'ncp:kkobizmsg:kr:2639830:wikibox';

//ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
include_once($_lib['directory']['library'].'/lib.php')
?>
```


#### 10-3. ë¡œì»¬ ë¬¸ì—ì„œ ì„œë²„ ì ‘ì† ì£¼ì†Œ ìˆ˜ì •
```less
# ê¸°ì¡´ì„œë²„ ì£¼ì†Œ
"api.hizib.wikibox.kr"

# ë³€ê²½ì„œë²„ ì£¼ì†Œ
api2.hizib.wikibox.kr
```

#### 10-4. ì„œë²„ ì£¼ì†Œ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ ìˆ˜ì • (ë¡œì»¬ ë””ë°”ì´ìŠ¤)
```less
grep -r "api.hizib.wikibox.kr" ./

"api2.hizib.wikibox.kr" ì£¼ì†Œë¡œ ë³€ê²½

~/www/js/jquery.elc.hizib.garbage.js
~/www/js/jquery.elc.hizib.ws.receive.js
~/www/kiosk/js/jquery.elc.hizib.garbage.js
~/www/kiosk/js/jquery.elc.hizib.ws.receive.js
~/www/kiosk/python/elcsoft/component.py
~/www/kiosk/python/elcsoft/model/code.py
~/www/kiosk/python/elcsoft/model/smartdoor_group.py
~/www/kiosk/python/elcsoft/controller/smartdoor_vod.py
~/www/kiosk/python/elcsoft/controller/smartdoor_guestkey.py
~/www/kiosk/python/elcsoft/controller/smartdoor_schedule.py
~/www/kiosk/python/elcsoft/controller/user.py
~/www/kiosk/python/elcsoft/controller/smartdoor_notice.py
~/www/kiosk/python/elcsoft/controller/smartdoor_log.py
~/www/kiosk/python/elcsoft/controller/smartdoor_message.py
~/www/kiosk/python/elcsoft/controller/smartdoor_item.py
~/www/kiosk/python/elcsoft/controller/smartdoor_group.py
~/www/kiosk/python/elcsoft/controller/smartdoor.py
~/www/kiosk/python/elcsoft/controller/vod.py
~/www/kiosk/python/elcsoft/controller/smartdoor_user.py
~/www/kiosk/python/elcsoft/controller/smartdoor_cmd.py
~/www/kiosk/python/weather.py
~/www/kiosk/html/user/view.html
~/www/python/elcsoft/component.py
~/www/python/elcsoft/model/code.py
~/www/python/elcsoft/model/smartdoor_group.py
~/www/python/elcsoft/controller/smartdoor_vod.py
~/www/python/elcsoft/controller/smartdoor_guestkey.py
~/www/python/elcsoft/controller/smartdoor_schedule.py
~/www/python/elcsoft/controller/user.py
~/www/python/elcsoft/controller/smartdoor_notice.py
~/www/python/elcsoft/controller/smartdoor_log.py
~/www/python/elcsoft/controller/smartdoor_message.py
~/www/python/elcsoft/controller/smartdoor_item.py
~/www/python/elcsoft/controller/smartdoor_group.py
~/www/python/elcsoft/controller/smartdoor.py
~/www/python/elcsoft/controller/vod.py
~/www/python/elcsoft/controller/smartdoor_user.py
~/www/python/elcsoft/controller/smartdoor_cmd.py
~/www/html/user/view.html
~/www/python/weather.py
```

#### 10-5. ì„œë²„ ì£¼ì†Œ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ ìˆ˜ì • (ë¡œì»¬ë””ë°”ì´ìŠ¤)
```less
grep -r "13.124.155.19" ./

175.211.153.28 ì£¼ì†Œë¡œ ë³€ê²½
```

