1. ê³„ì •ìƒì„±

2. í‚¤ ìƒì„±

3. ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ìƒì„±

4. iot hub ìƒì„±

5. ë””ë°”ì´ìŠ¤ ìƒì„±

6. ê¸°ë³¸ ì—°ê²°ë¬¸ìì—´ ë³µì‚¬



âœ… ë¼ì¦ˆë² ë¦¬íŒŒì´ì— SDK ì„¤ì¹˜ (Python ì˜ˆì‹œ)

```less
IoT Hubì™€ ì—°ê²°í•˜ë ¤ë©´ Pythonìš© SDK ì„¤ì¹˜

pip install azure-iot-device
```

âœ… ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ë©”ì„¸ì§€ë³´ë‚´ê¸°

```less
from azure.iot.device import IoTHubDeviceClient

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

device_client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)

# ì—°ê²°
device_client.connect()

# ë©”ì‹œì§€ ì „ì†¡
device_client.send_message("Hello from Raspberry Pi!")

print("Message sent!")

# ì—°ê²° ì¢…ë£Œ
device_client.disconnect()

```
#### (í´ë¼ìš°ë“œ -> ë””ë°”ì´ìŠ¤) ë©”ì„¸ì§€ ìˆ˜ì‹ í™•ì¸
```less
from azure.iot.device import IoTHubDeviceClient

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

def message_handler(message):
    print("Received message:")
    print(message.data)
    print("Properties:", message.custom_properties)

client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)
client.on_message_received = message_handler

print("Listening for messages...")
client.connect()

import time
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    print("Stopping")
finally:
    client.shutdown()
```

#### ì—°ê²°ëœ ì¥ì¹˜ í™•ì¸
```less
ls /dev/ttyUSB*

ê²°ê³¼ : /dev/ttyUSB_PIR
```

#### ì •í™•í•œ í¬íŠ¸ ìë™ í™•ì¸ (ì¶”ì²œ)
```less
dmesg | grep tty
```

#### ì‹¤ì œë¡œ ì–´ë–¤ í¬íŠ¸(/dev/ttyUSB0 ë“±)ë¡œ ì—°ê²°ë¼ ìˆëŠ”ì§€ í™•ì¸
```less
ls -l /dev/ttyUSB_PIR

ê²°ê³¼ : /dev/ttyUSB_PIR -> ttyACM0
```

âœ… ì •ë¦¬
```less
ì‹¤ì œ ì¥ì¹˜ í¬íŠ¸: /dev/ttyACM0

udev ì‹¬ë³¼ë¦­ ë§í¬ ì´ë¦„: /dev/ttyUSB_PIR

ì¦‰, /dev/ttyUSB_PIRëŠ” ë‚´ë¶€ì ìœ¼ë¡œ /dev/ttyACM0ì„ ê°€ë¦¬í‚¤ê³  ìˆìœ¼ë©°, ì´ê±¸ Hione í¬íŠ¸ë¡œ ì“°ë©´ ì •í™•í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.
```

#### ë©”ì„¸ì§€ì˜¤ë©´ ë¬¸ì—´ê¸° ëª¨ë“ˆ
```less
import time
from azure.iot.device import IoTHubDeviceClient
from hione import Hione  # hione.pyì—ì„œ Hione í´ë˜ìŠ¤ import

# Hione ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (í¬íŠ¸ ì§€ì •)
hione = Hione(port='/dev/ttyUSB_PIR')

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

def message_handler(message):
    try:
        msg = message.data.decode('utf-8').strip()
    except Exception as e:
        print("ë©”ì‹œì§€ ë””ì½”ë”© ì˜¤ë¥˜:", e)
        msg = ""

    print("Received message:", msg)
    print("Properties:", message.custom_properties)

    if msg.lower() == "open":
        try:
            hione.doorOpenProcess()
        except Exception as e:
            print("ğŸš¨ doorOpenProcess() ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e)

client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)

try:
    client.connect()
    client.on_message_received = message_handler
    print("Listening for messages...")

    while True:
        time.sleep(1)

except KeyboardInterrupt:
    print("Stopping")

except Exception as e:
    print("ğŸ’¥ ì „ì²´ ì˜ˆì™¸ ë°œìƒ:", e)

finally:
    client.shutdown()


```
