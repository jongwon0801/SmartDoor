1. 계정생성

2. 키 생성

3. 리소스 그룹생성

4. iot hub 생성

5. 디바이스 생성

6. 기본 연결문자열 복사



✅ 라즈베리파이에 SDK 설치 (Python 예시)

```less
IoT Hub와 연결하려면 Python용 SDK 설치

pip install azure-iot-device
```

✅ 라즈베리파이에서 메세지보내기

```less
from azure.iot.device import IoTHubDeviceClient

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

device_client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)

# 연결
device_client.connect()

# 메시지 전송
device_client.send_message("Hello from Raspberry Pi!")

print("Message sent!")

# 연결 종료
device_client.disconnect()

```
#### (클라우드 -> 디바이스) 메세지 수신확인
```less
from azure.iot.device import IoTHubDeviceClient

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

def message_handler(message):
    print("Received message:")
    print(message.data)
    print("Properties:", message.custom_properties)

client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)
client.on_message_received = message_handler

print("Listening for messages...")
client.connect()

import time
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    print("Stopping")
finally:
    client.shutdown()
```

#### 연결된 장치 확인
```less
ls /dev/ttyUSB*

결과 : /dev/ttyUSB_PIR
```

#### 정확한 포트 자동 확인 (추천)
```less
dmesg | grep tty
```

#### 실제로 어떤 포트(/dev/ttyUSB0 등)로 연결돼 있는지 확인
```less
ls -l /dev/ttyUSB_PIR

결과 : /dev/ttyUSB_PIR -> ttyACM0
```

✅ 정리
```less
실제 장치 포트: /dev/ttyACM0

udev 심볼릭 링크 이름: /dev/ttyUSB_PIR

즉, /dev/ttyUSB_PIR는 내부적으로 /dev/ttyACM0을 가리키고 있으며, 이걸 Hione 포트로 쓰면 정확하게 작동합니다.
```

#### 메세지오면 문열기 모듈
```less
import time
from azure.iot.device import IoTHubDeviceClient
from hione import Hione  # hione.py에서 Hione 클래스 import

# Hione 인스턴스 생성 (포트 지정)
hione = Hione(port='/dev/ttyUSB_PIR')

CONNECTION_STRING = "HostName=smartdoor.azure-devices.net;DeviceId=smartdoor1;SharedAccessKey=L6nXuaejjwCA51bdBLIoCgPOE2RNxtz7PlzeXII6xdg="

def message_handler(message):
    try:
        msg = message.data.decode('utf-8').strip()
    except Exception as e:
        print("메시지 디코딩 오류:", e)
        msg = ""

    print("Received message:", msg)
    print("Properties:", message.custom_properties)

    if msg.lower() == "open":
        try:
            hione.doorOpenProcess()
        except Exception as e:
            print("🚨 doorOpenProcess() 실행 중 오류 발생:", e)

client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)

try:
    client.connect()
    client.on_message_received = message_handler
    print("Listening for messages...")

    while True:
        time.sleep(1)

except KeyboardInterrupt:
    print("Stopping")

except Exception as e:
    print("💥 전체 예외 발생:", e)

finally:
    client.shutdown()


```
